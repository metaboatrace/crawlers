from metaboatrace.orm.database import Session
from metaboatrace.orm.models.racer import Racer

TERMS_DICT = {
    40: (2764, 2796),
    41: (2798, 2810),
    42: (2811, 2848),
    43: (2849, 2878),
    44: (2880, 2904),
    45: (2095, 2927),
    46: (2928, 2947),
    47: (2948, 2966),
    48: (2968, 2998),
    49: (3001, 3025),
    50: (3030, 3055),
    51: (3056, 3081),
    52: (3083, 3108),
    53: (3109, 3131),
    54: (3135, 3159),
    55: (3160, 3183),
    56: (3184, 3209),
    57: (3210, 3234),
    58: (3235, 3258),
    59: (3259, 3286),
    60: (3287, 3307),
    61: (3308, 3335),
    62: (3336, 3362),
    63: (3363, 3388),
    64: (3389, 3422),
    65: (3424, 3456),
    66: (3457, 3485),
    67: (3486, 3510),
    68: (3513, 3535),
    69: (3536, 3558),
    70: (3559, 3590),
    71: (3591, 3623),
    72: (3624, 3659),
    73: (3660, 3686),
    74: (3687, 3721),
    75: (3722, 3749),
    76: (3750, 3784),
    77: (3785, 3817),
    78: (3818, 3849),
    79: (3850, 3878),
    80: (3879, 3908),
    81: (3909, 3944),
    82: (3945, 3967),
    83: (3968, 3999),
    84: (4000, 4022),
    85: (4023, 4052),
    86: (4053, 4075),
    87: (4076, 4098),
    88: (4099, 4124),
    89: (4125, 4151),
    90: (4152, 4184),
    91: (4185, 4216),
    92: (4217, 4244),
    93: (4245, 4269),
    94: (4270, 4296),
    95: (4297, 4324),
    96: (4325, 4353),
    97: (4354, 4373),
    98: (4374, 4400),
    99: (4401, 4423),
    100: (4424, 4456),
    101: (4457, 4484),
    102: (4485, 4515),
    103: (4516, 4539),
    104: (4540, 4561),
    105: (4562, 4590),
    106: (4591, 4612),
    107: (4613, 4643),
    108: (4644, 4661),
    109: (4662, 4690),
    110: (4691, 4720),
    111: (4721, 4746),
    112: (4747, 4776),
    113: (4777, 4804),
    114: (4805, 4831),
    115: (4832, 4857),
    116: (4858, 4886),
    117: (4887, 4915),
    118: (4916, 4940),
    119: (4941, 4967),
    120: (4968, 4994),
    121: (4995, 5019),
    122: (5020, 5045),
    123: (5046, 5069),
    124: (5070, 5094),
    125: (5095, 5122),
    126: (5123, 5146),
    127: (5147, 5175),
    128: (5176, 5203),
    129: (5204, 5231),
    130: (5232, 5258),
    131: (5259, 5283),
    132: (5284, 5310),
    133: (5311, 5337),
    134: (5338, 5362),
}


def update_terms() -> None:
    session = Session()
    try:
        racers = session.query(Racer).filter(Racer.term.is_(None)).all()

        for racer in racers:
            for term, (start, end) in TERMS_DICT.items():
                if start <= racer.registration_number <= end:
                    racer.term = term  # type: ignore
                    print(f"Updated racer {racer.registration_number} to term {term}")
                    break

        session.commit()
        print("All eligible racers have been updated.")
    except Exception as e:
        session.rollback()
        print(f"An error occurred: {e}")
    finally:
        session.close()


if __name__ == "__main__":
    update_terms()
